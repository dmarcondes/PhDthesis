#Digits classification MNIST
library(keras)
library(tidyverse)
#wd
setwd("~/GDrive/PESQUISA/Machine Learning/Software/multilayerWOperator/mnist")
#Data
c(c(xtrain, ytrain), c(xtest, ytest)) %<-% dataset_mnist()
for(i in 1:nrow(xtrain))
xtrain[i,,] <- as.numeric(xtrain[i,,] > 0)
set.seed(759)
s <- sample(x = 1:nrow(xtrain),size = floor(0.75*nrow(xtrain)),replace = F)
yval <- ytrain[!(1:nrow(xtrain) %in% s)]
ytrain <- ytrain[(1:nrow(xtrain) %in% s)]
xval <- xtrain[!(1:nrow(xtrain) %in% s),,]
xtrain <- xtrain[(1:nrow(xtrain) %in% s),,]
for(i in 1:nrow(xtrain))
write.table(x = xtrain[i,,],file = paste("train",formatC(x = i,digits = 5,flag = "0"),".txt",sep = ""),sep = " ",row.names = F,col.names = F)
write.table(x = cbind(ytrain),file = "ytrain.txt",sep = " ",row.names = F,col.names = F)
for(i in 1:nrow(xval))
write.table(x = xval[i,,],file = paste("val",formatC(x = i,digits = 5,flag = "0"),".txt",sep = ""),sep = " ",row.names = F,col.names = F)
write.table(x = cbind(yval),file = "yval.txt",sep = " ",row.names = F,col.names = F)
#####Teste janelas####
setwd("~/GDrive/PESQUISA/Machine Learning/Software/multilayerWOperator/trace_server")
W <- read.table("W_0_00012.txt")
joint <- read.table("Joint_0_00012.txt",colClasses = c("factor","factor","factor"))
res <- vector()
for(s in 1:length(xval)){
if(s %% 500 == 0)
print(s)
M <- rbind(rep(0,29),cbind(rep(0,28),xval[s,,]))
for(l in 0:6){
Wtmp <- W %>% filter(V1 == l)
jointtmp <- joint %>% filter(V1 == l)
M1 <- matrix(nrow = nrow(M) - 4,ncol = ncol(M) - 4)
for(i in 3:(nrow(M) - 2))
for(j in 3:(ncol(M) - 2)){
val <- ""
for(k in 1:nrow(Wtmp))
val <- paste(val,M[i + Wtmp$V2[k],j + Wtmp$V3[k]],sep = "")
M1[i-2,j-2] <- as.numeric(as.character(jointtmp$V3[jointtmp$V2 == val]))
}
M <- M1
}
res[s] <- M[1,1]
}
prop.table(table(res[1:100],yval[1:100]))
prop.table(table(res[1:100],yval[1:100] == 0))
sum(diag(prop.table(table(res[1:100],yval[1:100] == 0))))
1-sum(diag(prop.table(table(res[1:100],yval[1:100] == 0))))
res <- vector()
for(s in 1:length(xval)){
if(s %% 500 == 0)
print(s)
M <- rbind(rep(0,29),cbind(rep(0,28),xval[s,,]))
for(l in 0:6){
Wtmp <- W %>% filter(V1 == l)
jointtmp <- joint %>% filter(V1 == l)
M1 <- matrix(nrow = nrow(M) - 4,ncol = ncol(M) - 4)
for(i in 3:(nrow(M) - 2))
for(j in 3:(ncol(M) - 2)){
val <- ""
for(k in 1:nrow(Wtmp))
val <- paste(val,M[i + Wtmp$V2[k],j + Wtmp$V3[k]],sep = "")
M1[i-2,j-2] <- as.numeric(as.character(jointtmp$V3[jointtmp$V2 == val]))
}
M <- M1
}
res[s] <- M[1,1]
}
1-sum(diag(prop.table(table(res,yval == 0))))
